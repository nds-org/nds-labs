<!-- The Configuration Wizard -->
<!-- TODO: Lots of hacks in here... this needs work -->
<section>
  <div class="modal-header">
    <!-- Wizard progress bar here -->
    <div class="progress">
      <div class="progress-bar" ng-class="{ 'progress-bar-success': wizard.percentage == 100}" role="progressbar" aria-valuenow="{{ wizard.percentage }}" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: {{ wizard.percentage }}%;">
        {{ wizard.percentage | number:0 }}%
      </div>
    </div>

    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" ng-click="close()">&times;</span></button>
    <h4 class="modal-title" id="wizardModalLabel">{{ newStackLabel }}: {{ wizard.currentPage.displayName }}</h4>
  </div>
  
  <!-- -->
  <div class="modal-body">
    <div class="row">
      <!-- Wizard Page selector -->
      <div class="col-md-12">
        <!-- Wizard Pages shown here -->
        <div ng-if="wizard.currentPage.key === 'intro'">
          <p>This wizard will now guide you through the steps of choosing any required / optional plugins or configuration customizations for {{ newStackLabel }}.</p>
          <p>Please choose a <strong>name</strong> for this stack:
            <input class="form-control" type="text" ng-model="newStack.name" />
          </p>
        </div>

        <!-- Configuration Page -->
        <div ng-if="wizard.currentPage.key === 'config'">

          <!-- List Required Services -->
          <p>Stack services:</p>
          <ul class="list-group">
            <li ng-repeat="req in newStackRequirements" class="list-group-item disabled">
              {{ req.service }}
              <input class="pull-right" type="checkbox" checked="true" />
            </li>
          </ul>

          <!-- List Optional Services -->
          <p ng-show="newStackOptions.length > 0">Please choose the optional service plugins that you wish to enable below:</p>
          <ul class="list-group" ng-class="{ 'active':optionalLinksGrid.selector.selection.indexOf(opt) !== -1 }">
            <li ng-class="{ 'active':optionalLinksGrid.selector.selection.indexOf(opt) !== -1 }" ng-click="optionalLinksGrid.selector.select.toggle(opt)" ng-repeat="opt in newStackOptions" class="list-group-item">
              <p>
                <div class="row">
                  <div class="col-md-4">{{ opt.service }}</div>
                  <div class="col-md-4">
                    <span ng-if="newStackOptionalDeps[opt.service].length > 0">
                      Requirements: 
                      <span ng-if="$index === 0" ng-repeat="dep in newStackOptionalDeps[opt.service]"><strong>{{ dep }}</strong></span>
                      <span ng-if="$index !== 0" ng-repeat="dep in newStackOptionalDeps[opt.service]">, <strong>{{ dep }}</strong></span>
                    </span>
                  </div>
                  <div class="col-md-1 col-offset-md-1 pull-right">
                    <div class="pull-right">
                      <input type="checkbox" ng-checked="optionalLinksGrid.selector.selection.indexOf(opt) !== -1" />
                    </div>
                  </div>
                </div>
              </p>
            </li>
          </ul>
        </div>

        <!-- Volumes Page -->
        <div ng-if="wizard.currentPage.key === 'volumes'">
          <p>It looks like you are adding {{ newStackVolumeRequirements.length }} service{{ newStackVolumeRequirements > 1 ? 's' : '' }} that require{{ newStackVolumeRequirements > 1 ? '' : 's' }} a volume.</p>

          <!-- Create New Volumes -->
          <div class="panel panel-default" ng-repeat="volume in newStackVolumeRequirements">
            <div class="panel-heading">
              <h4 class="panel-title">{{ volume.service }}</h4></div>


            <div class="panel-body">
              <!-- Reuse Orphaned Volumes? -->
              <div ng-if="newStackOrphanedVolumes && (newStackOrphanedVolumes | orphansExist:volume.service).length > 0">
                <p>Your namespace contains one or more detattached volumes that were previously associated with {{ volume.service }}.</p>
                <p>Would you like to reuse the data on from volume, or create a new volume?</p>
                <div class="radio" ng-click="volume.useOrphan=true;volume.name=''">
                  <label>
                    <input type="radio" ng-checked="volume.useOrphan" name="orphaned{{ volume.service }}VolumeRadio">Reuse Previous Data</label>
                </div>
                <div class="radio" ng-click="volume.useOrphan=false;volume.name=''">
                  <label>
                    <input type="radio" ng-checked="!volume.useOrphan" name="orphaned{{ volume.service }}VolumeRadio">Create New Volume</label>
                </div>
              </div>

              <!-- List usable orphaned volumes -->
              <div ng-show="volume.useOrphan">
                <div class="radio" ng-repeat="orphan in newStackOrphanedVolumes | orphansExist:volume.service" ng-click="volume.useOrphan=true;volume.name = orphan.name;volume.id = orphan.id;">
                  <label>
                    <input type="radio" ng-checked="volume.name === orphan.name" name="orphaned{{ volume.service }}OrphanVolumeRadio">{{ orphan.name }} (Source: {{ orphan.stack }})</label>
                </div>
              </div>

              <!-- Create a New Volume -->
              <form class="form-inline" ng-show="!volume.useOrphan">
                <!-- Volume Name -->
                <div class="row">
                  <div class="col-sm-12 form-group">
                    <label for="inputVolumeName">Volume Name</label>
                    <input type="text" class="form-control" id="inputVolumeName" placeholder="Volume Name" ng-model="volume.name">
                  </div>
                </div>


                <div class="row">

                  <!-- Volume Format -->
                  <div class="col-sm-6 form-group">
                    <label for="inputVolumeFormat">Volume Format</label>
                    <select type="text" class="form-control" id="inputVolumeFormat" ng-model="volume.format">
                      <option ng-repeat="format in ['Raw','HostPath','EXT4','FAT32']">{{ format }}</option>
                    </select>
                  </div>

                  <!-- Volume Size / Units -->
                  <div class="col-sm-6 form-group">
                    <label for="inputVolumeSize">Volume Size:</label>
                    <div class="input-group" id="inputVolumeSize">
                      <!-- Size -->
                      <input type="number" name="volumeSize" min="1" max="999" class="form-control" ng-model="volume.size" aria-label="Please enter desired Volume Size.">

                      <!-- Units -->
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ volume.sizeUnit || 'Choose Units' }} <span class="caret"></span></button>
                        <ul class="dropdown-menu dropdown-menu-right">
                          <li><a href="#/labs" ng-click="volume.sizeUnit='GB'">GB</a></li>
                          <li><a href="#/labs" ng-click="volume.sizeUnit='TB'">TB</a></li>
                        </ul>
                      </div>
                      <!-- /btn-group -->
                    </div>
                    <!-- /input-group -->
                  </div>
                  <!-- /form-group -->
                </div>
                <!-- /row -->

              </form>
            </div>
          </div>
        </div>

        <!-- Ask the user for confirmation -->
        <div ng-if="wizard.currentPage.key === 'confirm'">
          <p>Please confirm the configuration of your new stack below.</p></p>
          <p>If the configuration looks correct, click <strong>Confirm</strong> to close the wizard and add these changes to your namespace.</p>
        
          <p>You have chosen to enable {{ optionalLinksGrid.selector.selection.length || "no" }} optional service plugins<span ng-show="newService.links.required">, along with the {{ newService.links.required.length }} required services</span>.</p>
          <p>Services that will be added to the "{{ newStack.name }}" stack:</p>
          <ul class="list-group">
            <li class="list-group-item disabled" ng-repeat="req in newStack.services">{{ req.service }}</li>
          </ul>

          <p>Volumes that will be used within the "{{ newStack.name }}" stack:</p>
          <ul class="list-group">
            <li class="list-group-item disabled" ng-repeat="volume in newStackVolumeRequirements">{{ volume.name }}: {{ volume.size }} {{ volume.sizeUnit }}</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Progress / Button Bar at the bottom -->
  <div class="modal-footer">
    <!-- "Cancel" button (close modal with success === false) -->
    <button class="btn btn-danger pull-left" ng-click="close()">
      <i class="fa fa-fw fa-times"></i>
      Cancel
      </button>

    <!-- Previous Page -->
    <div class="pull-right">
      <button class="btn btn-primary" ng-disabled="!wizard.canPrevPage()"
          ng-click="wizard.prevPage()">
        <i class="fa fa-fw fa-arrow-circle-left"></i>
        Back
      </button>
  
      <!-- Next Page -->
      <button class="btn btn-primary" ng-disabled="!wizard.canNextPage()"
          ng-click="wizard.nextPage()" ng-if="wizard.currentPage.key !== 'confirm'">
        Next
        <i class="fa fa-fw fa-arrow-circle-right"></i>
      </button>
  
      <!-- "Finish" button (close modal with success === true) -->
      <button class="btn btn-success" ng-disabled="!wizard.canPrevPage()"
          ng-click="ok()" ng-if="wizard.currentPage.key === 'confirm'">
        Confirm
        <i class="fa fa-fw fa-check-circle"></i>
      </button>
    </div>
  </div>
</section>