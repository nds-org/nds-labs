<!-- The Configuration Wizard -->
<!-- TODO: Lots of hacks in here... this needs work -->
<section>
  <div class="modal-header">
    <!-- Wizard progress bar here -->
    <div class="progress">
      <div class="progress-bar" ng-class="{ 'progress-bar-success': wizard.percentage == 100}" role="progressbar" aria-valuenow="{{ wizard.percentage }}" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: {{ wizard.percentage }}%;">
        {{ wizard.percentage | number:0 }}%
      </div>
    </div>

    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" ng-click="close()">&times;</span></button>
    <h4 class="modal-title" id="wizardModalLabel">{{ newStackLabel }}: {{ wizard.currentPage.displayName }}</h4>
  </div>
  
  <div class="modal-body">
    <div class="row">
      <!-- Wizard Page selector -->
      <div class="col-md-12">
        <!-- Requirements Page -->
        <div ng-if="wizard.currentPage.key === 'require'">
          <p>{{ spec.description || 'Insert Description Here' }}</p>
          <p>Services which are required in order to run {{ spec.label }}:</p>
              <!-- List Required Services -->
          <div class="row">
            <div class="col-sm-12">
              <ul class="list-group">
                <li ng-repeat="req in newStackRequirements" class="list-group-item disabled">
                  <div class="row">
                    <div class="col-sm-9">
                      {{ req.service | specProperty:'label' }}
                    </div>
                    <div class="col-sm-3 pull-right">
                      <i class="fa fa-fw fa-database faa-flash animated pull-right" tooltip-placement="left"
                      uib-tooltip="{{ req.service | specProperty:'label' }} requires a volume to house its 
                      data. You will be guided through setting up a volume as a part of this wizard."
                      ng-if="(req.service | specProperty:'requiresVolume') === true"></i>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
            
          <!-- Allow user to specify a unique name -->
          <div class="row">
            <div class="col-sm-12">
              <input class="form-control" autofocus type="text" ng-model="newStack.name"
                     required placeholder="Choose a unique name for this stack" />
            </div>
          </div>
        </div>
        
        <!-- Options Page -->
        <div ng-if="wizard.currentPage.key === 'options'">
          <div class="row">
            <div class="col-sm-12" ng-show="newStackOptions.length > 0">
              <!-- List Optional Services -->
              <p>{{ spec.label }} has {{ newStackOptions.length }} optional services associated with it.</p>
              <p>Select any optional services that you would like to enable:</p>
              <ul class="list-group">
                <li ng-class="{ 'list-group-item-info':optionalLinksGrid.selector.selection.indexOf(opt) !== -1 }" 
                    ng-click="optionalLinksGrid.selector.select.toggle(opt)"
                    ng-repeat="opt in newStackOptions" class="list-group-item cursor-pointer">
                  <div class="row">
                    <div class="col-sm-10">
                      {{ opt.service | specProperty:'label' }}
                    </div>
                    <div class="col-sm-1">
                      <i class="fa fa-fw fa-warning faa-flash animated pull-right" tooltip-placement="left"
                      uib-tooltip="{{ opt.service | specProperty:'label' }} requires 
                      {{ newStackOptionalDeps[opt.service] | formatDependencies }}. 
                      {{ newStackOptionalDeps[opt.service].length > 1 ? 'These' : 'This' }} 
                      will automatically be added for you by this wizard when you select 
                      {{ opt.service | specProperty:'label' }}."
                      ng-if="newStackOptionalDeps[opt.service].length > 0"></i>
                    </div>
                    <div class="col-sm-1 pull-right">
                      <input class="cursor-pointer" type="checkbox" ng-checked="optionalLinksGrid.selector.selection.indexOf(opt) !== -1"/>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Volumes Page -->
        <div ng-if="wizard.currentPage.key === 'volumes'">
          <!-- Create New Volumes -->
          <div class="panel panel-info" ng-repeat="volume in newStackVolumeRequirements track by volume.service">
            <div class="panel-heading">
              <h4 class="panel-title">{{ volume.service | specProperty:'label' }}</h4>
            </div>


            <div class="panel-body">
              <div class="row">
                <div class="col-sm-12">
                  
                  <!-- Reuse Orphaned Volumes? -->
                  <form class="form" ng-if="(newStackOrphanedVolumes | orphansExist:volume.service).length" 
                  uib-tooltip="Your namespace contains one or more detattached volumes that were previously associated with {{ volume.service }}. Would you like to reuse the data on from volume, or create a new volume?">
                    <fieldset>
                      <div class="form-group">
                        <div class="radio" ng-repeat="orphan in newStackOrphanedVolumes | orphansExist:volume.service track by orphan.id" ng-click="volume.id=orphan.id;volume.name=orphan.name">
                          <label>
                         <!--<input id="inlineradio1" name="sampleinlineradio" value="option1" type="radio">
                           Radio 0</label>
                           <label>-->
                            <input type="radio" ng-checked="volume.id === orphan.id" name="orphaned{{ volume.service }}VolumeRadio">
                             
                            Use existing data from <strong tooltip-placement="right" uib-tooltip="{{ orphan.size }} {{ orphan.sizeUnit }}">{{ orphan.name }}</strong>
                          </label>
                        </div>
                        <div class="radio" ng-click="volume.id='';volume.name=volume.defaultName;">
                          <label>
                            <input type="radio" ng-checked="volume.id === ''" name="orphaned{{ volume.service }}VolumeRadio">
                            Create a new volume
                          </label>
                        </div>
                      </div>
                    <!--form-group-->
                    </fieldset>
                  </form>
                </div>
              </div>

              <!-- Create a New Volume -->
              <form class="form-inline" ng-show="volume.id === ''">
                <!-- Volume Name -->
                <div class="row">
                  <div class="col-sm-8">
                    <input style="width:100%;" type="text" class="form-control" id="inputVolumeName" placeholder="Enter a name for this volume" ng-model="volume.name">
                  </div>

                  <!-- Volume Format -->
                  <!--<div class="col-sm-2 form-group">
                    <label for="inputVolumeFormat">Format</label>
                    <select type="text" class="form-control" id="inputVolumeFormat" ng-model="volume.format">
                      <option ng-repeat="format in ['Raw','HostPath','EXT4','FAT32']">{{ format }}</option>
                    </select>
                  </div>-->

                  <!-- Volume Size / Units -->
                  <div class="col-sm-4">
                    <div class="input-group pull-right" id="inputVolumeSize">
                      <!-- Size -->
                      <input type="number" name="volumeSize" min="1" max="999" class="form-control" ng-model="volume.size" aria-label="Please enter desired Volume Size.">

                      <!-- Units -->
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ volume.sizeUnit || 'Choose Units' }} <span class="caret"></span></button>
                        <ul class="dropdown-menu dropdown-menu-right">
                          <li><a href="#/labs" ng-click="volume.sizeUnit='GB'">GB</a></li>
                          <li><a href="#/labs" ng-click="volume.sizeUnit='TB'">TB</a></li>
                        </ul>
                      </div>
                      <!-- /btn-group -->
                    </div>
                    <!-- /input-group -->
                  </div>
                  <!-- /form-group -->
                </div>
                <!-- /row -->

              </form>
            </div>
          </div>
        </div>

        <!-- Ask the user for confirmation -->
        <div ng-if="wizard.currentPage.key === 'confirm'">
          <div class="row">
            <div ng-class="{ 'col-sm-6':  newStackVolumeRequirements.length > 0, 
                             'col-sm-12': newStackVolumeRequirements.length === 0 }">
              <h4 class="text-center">Services</h4>
              <ul class="list-group">
                <li class="list-group-item disabled" ng-repeat="req in newStack.services">{{ req.service }}</li>
              </ul>
            </div>
            <div class="col-sm-6" ng-if="newStackVolumeRequirements.length > 0">
              <h4 class="text-center">Volumes</h4>
              <ul class="list-group">
                <li class="list-group-item disabled" ng-repeat="volume in newStackVolumeRequirements">{{ volume.name }}: {{ volume.size }} {{ volume.sizeUnit }}</li>
              </ul>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <p ng-if="newStackOptions.length > 0">You have chosen to enable {{ optionalLinksGrid.selector.selection.length || "no" }} 
                  optional service plugins<span ng-show="newService.links.required">, along with the {{ newService.links.required.length }} 
                  required services</span>.
              </p>
                  
              <p>Please confirm the configuration of your new stack above.</p>
              
              <p>Clicking <strong>Confirm</strong> will close the wizard and add this new stack to your namespace.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Progress / Button Bar at the bottom -->
  <div class="modal-footer">
    <!-- "Cancel" button (close modal with success === false) -->
    <button class="btn btn-danger pull-left" ng-click="close()">
      <i class="fa fa-fw fa-times"></i>
      Cancel
      </button>

    <!-- Previous Page -->
    <div class="pull-right">
      <button class="btn btn-primary" ng-disabled="!wizard.canPrevPage()"
          ng-click="wizard.prevPage()">
        <i class="fa fa-fw fa-arrow-circle-left"></i>
        Back
      </button>
  
      <!-- Next Page -->
      <button class="btn btn-primary" ng-disabled="!wizard.canNextPage()"
          ng-click="wizard.nextPage()" ng-if="wizard.currentPage.key !== 'confirm'">
        Next
        <i class="fa fa-fw fa-arrow-circle-right"></i>
      </button>
  
      <!-- "Finish" button (close modal with success === true) -->
      <button class="btn btn-success" ng-disabled="!wizard.canPrevPage()"
          ng-click="ok()" ng-if="wizard.currentPage.key === 'confirm'">
        Confirm
        <i class="fa fa-fw fa-check-circle"></i>
      </button>
    </div>
  </div>
</section>