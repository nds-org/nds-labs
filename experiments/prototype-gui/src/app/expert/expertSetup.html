<section>
  <!-- Selector(s) Pane -->
  <div class="row">
    <div class="col-md-12">
      <div class="jumbotron">
        <h1 class="text-center">Welcome to {{ app.name }}</h1>
        <h4 class="text-center">{{ app.tagline }}</h4>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-3">    
        <h4>Services</h4>
        <div>
          <div id="stackSearchHeader">
            <div class="input-group">
              <span class="input-group-addon" id="basic-addon1"><i class="fa fa-search"></i></span>
              <input type="text" class="form-control" placeholder="Search..." ng-model="svcQuery" 
                  aria-describedby="basic-addon1" />
            </div>
            
            <span class="label label-danger" ng-show="(allServices | filter : svcQuery).length === 0">
              No services matched the specified query
            </span>
          </div>
          
          <table class="table table-striped table-condensed table-hover" 
              ng-hide="(allServices | filter : svcQuery).length === 0">
            <thead>
              <tr>
                <td width="95%"></td>
                <td width="5%"></td>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="stack in allServices | orderBy:'key'| filter : svcQuery">
                <td>{{ stack.label }}</td>
                <td>
                  <button class="btn btn-xs btn-primary" ng-click="openWizard(stack)">
                    <i class="fa fa-plus"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
     
      <!-- Configured Stacks --> 
      <div class="col-md-9">
        <div>
          <div class="row">
            <div class="col-md-4">
              <h4>Configured Stacks</h4>
            </div>
            <div class="col-md-8">
              <div class="pull-right">
                <button class="btn btn-default" ng-click="refreshAll()" 
                      ng-mouseenter="iconSpin = true" ng-mouseleave="iconSpin = false">
                  <i class="fa fa-refresh" ng-class="{ 'fa-spin':iconSpin }"></i>
                  Refresh
                </button>
                <button class="btn btn-default" ng-click="showVolumePane=!showVolumePane">
                  {{ showVolumePane ? 'Hide' : 'Show' }} Volumes
                </button>
               <!-- <button class="btn btn-default">
                  Import
                </button>
                <button class="btn btn-default">
                  Export
                </button> -->
              </div>
            </div>
          </div>
          
          <!-- The "Volumes" Slide-Out Panel -->
          <pageslide ps-open="showVolumePane" ps-side="right" ps-squeeze>
              <div style="border:solid 2px gray;margin:0px">
                <button class="btn btn-default btn-lg pull-left" ng-click="showVolumePane = false;">
                  <i class="fa fa-angle-double-right"></i>
                </button>
                <h3 class="text-muted text-center">DATA</h3>
              </div>
        
              <!-- Slide-Out Panel Contents -->
              <div style="background-image: url('/asset/png/symphony.png');border:solid 2px gray;margin:0px;height:100%;width:100%;">
                <table class="table table-condensed">
                  <thead>
                    <tr>
                      <td width="70%"><strong>Name</strong></td>
                      <td width="20%"><strong>Size</strong></td>
                      <td width="10%"><strong></strong></td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="volume in configuredVolumes | orderBy:'name'">
                      <td><strong>{{ volume.name }}</strong></td>
                      <td>{{ volume.size }} {{ volume.sizeUnit }}</td>
                      <td>
                       <button class="btn btn-xs btn-danger" ng-if="!volume.attached" 
                           popover-title="WARNING!" popover-placement="left" popover-trigger="outsideClick"
                           uib-popover-template="'/app/expert/subviews/volumeDeletePopover.html'">
                          <i class="fa fa-fw fa-times"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
          </pageslide>
          
          <div ng-if="configuredStacks.length === 0" class="text-center" 
              style="border:dashed;padding-top:100px;padding-bottom:100px;vertical-align:middle;">
            <h2>It looks like you haven't configured any stacks yet!</h2>
            <h4>You can add services from the left-side of this page!</h4>
          </div>
          <uib-accordion ng-if="configuredStacks.length > 0" close-others="true">
            <uib-accordion-group ng-repeat="stack in configuredStacks | orderBy:'name'" is-open="open">
              <uib-accordion-heading>
                <!-- Stack Enable / Disable -->
                <div class="row">
                  <div class="col-md-2 text-center">
                    <i class="pull-left fa fa-fw fa-2x" 
                      ng-class="{ 'fa-check-circle-o text-success': stack.status === 'started', 
                          'fa-times-circle-o text-danger': stack.status === 'stopped',
                          'text-info fa-spinner fa-spin fa-pulse': stack.status.indexOf('ed') === -1 }"></i>
                  </div>
                  <div class="col-md-9">
                    <h4>{{ _.capitalize(stack.name) }}</h4>
                  </div>
                  <div class="col-md-1" style="vertical-align:middle;">
                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': open, 'glyphicon-chevron-right': !open}"></i>
                  </div>
                </div>
              </uib-accordion-heading>
              
                <!-- The stack's "Button Bar" -->
                <div class="row">
                  <!-- Stack Enable / Disable -->
                  <div class="col-md-2">
                    <div style="horizontal-align:middle;vertical-align:middle;">
                      <!--<toggle-switch ng-model="stack.status" ng-changed="toggleStatus(stack)"><toggle-switch>-->
                      <button class="btn btn-lg btn-block" ng-disabled="stack.status.indexOf('ing') !== -1" 
                          ng-if="stack.status.indexOf('start') === -1" ng-click="startStack(stack)">
                        <i class="fa fa-fw fa-circle-o-notch fa-spin" 
                            ng-if="stack.status.indexOf('ed') === -1"></i>
                        Start
                      </button>
                      <button class="btn btn-lg btn-block" ng-disabled="stack.status.indexOf('ing') !== -1" 
                          ng-if="stack.status.indexOf('stop') === -1" ng-click="stopStack(stack)">
                        <i class="fa fa-fw fa-circle-o-notch fa-spin" 
                            ng-if="stack.status.indexOf('ed') === -1"></i>
                        Stop
                      </button>
                    </div>
                  </div>
                      
                  <!-- The "Add Service" Button -->
                  <div class="col-md-2">
                    <a class="btn btn-xs btn-success" tabindex="0" 
                       uib-popover-template="'/app/expert/subviews/serviceAdd.html'" popover-append-to-body
                       popover-title="OPTIONAL SERVICES" ng-if="stack.status === 'stopped' && (stack | missingDeps).length > 0"
                       popover-placement="right-top" popover-trigger="outsideClick">
                      <i class="fa fa-plus fa-fw"></i><i class="fa fa-fw fa-caret-down"></i>
                    </a>
                  </div>
                  
                  <!-- The Delete Stack Button -->
                  <div class="col-md-offset-6 col-md-2" style="horizontal-align:middle;vertical-align:middle;">
                    <button style="display:inline-block;margin:auto;" class="btn btn-lg btn-danger pull-right"
                    ng-click="deletionCandidate = stack;removeCandidateStack(stack)" uib-tooltip="Delete this Stack from your Namespace">
                      <i class="fa fa-times"></i>
                    </button>
                  </div>
                </div>
                
                <!-- Stack Services -->
                <div class="row">
                  <div class="col-md-offset-2 col-md-9">
                    <ul class="fa-ul">
                      <!-- List off our stack's services here -->
                      <li ng-repeat="svc in stack.services track by svc.service">
                        <div class="row" style="margin:5px;">
                          <div class="col-md-4">
                            <!-- show status icon if services are started / stopped -->
                            <i ng-if="!showVolume(stack, svc)" class="fa-li fa fa-fw"
                              ng-class="{ 'fa-check-circle-o text-success':svc.status && stack.status.indexOf('ed') !== -1,
                                  'fa-times-circle-o text-danger':!svc.status && stack.status.indexOf('ed') !== -1,
                                  'fa-exclamation-circle text-warning': stack.status.indexOf('ed') === -1 }"></i>
                              
                            <!-- show volume details if we find a volume -->
                            <i ng-if="(volume = showVolume(stack, svc))" class="fa-li fa fa-fw fa-database" style="cursor:pointer;"
                               uib-popover-template="'/app/expert/subviews/volumeDetails.html'" 
                               ng-class="{ 'text-success': svc.status, 'text-danger': !svc.status  }"
                               popover-title="{{ showVolume(stack, svc).name | uppercase }}"
                               popover-placement="right" popover-trigger="outsideClick"></i>
                               
                            {{ svc.service }}
                            
                            <a ng-repeat="endpt in svc.endpoints" uib-tooltip="Navigate to {{ _.capitalize(svc.service) }} ({{ endpt }})"
                                ng-if="(stack.status === 'started' || stack.status === 'stopping') && svc.status === 'Running' 
                                    && svc.endpoints.length > 0 && svc.endpoints[0] !== ''"
                                href="{{ endpt }}" ng-disabled="stack.status === 'stopping' && svc.status === 'Running'">
                              <i class="fa fa-fw" ng-class="{ 'fa-chain': svc.status === 'Running', 
                                  'fa-chain-broken': stack.status === 'stopping' && svc.status === 'Running' }"></i>
                            </a>
                          </div>
                          
                          <!-- View logs button -->
                          <div class="col-md-1">
                            <button type="button" class="btn btn-xs btn-info" uib-tooltip="View Service Logs" 
                                tooltip-placement="left" ng-click="showLogs(svc)">
                              <i class="fa fa-fw fa-search"></i>
                            </button>
                          </div>
                          
                          <!-- Remove service from stack button -->
                          <div class="col-md-1">
                            <button type="button" ng-disabled="stack.services | isRecursivelyRequired:svc" 
                                ng-if="svc.service !== stack.key && (stack.key | requirements).indexOf(svc.service) === -1" 
                                class="btn btn-xs btn-danger" ng-click="removeStackSvc(stack, svc)" 
                                uib-tooltip="Remove Service from Stack" tooltip-placement="left">
                              <i class="fa fa-fw fa-times"></i>
                            </button>
                          </div>
                        </div>
                            <!-- link to endpoint, if one exists -->
                            <!--<div>
                              <a ng-if="svc.endpoints.length > 0" href="svc.endpoints[0]" style="margin-left:20px;">{{ svc.service }}</a>
                              <span ng-if="svc.endpoints. length === 0">{{ svc.service }}</span>
                            </div>-->
                            
                            <!-- "options" popover for services -->
                            <!--<a tabindex="0" uib-popover-template="'/app/expert/subviews/serviceOptionsPopover.html'" 
                            popover-title="{{ svc.service | uppercase }}" popover-placement="left"
                            popover-trigger="focus" id="{{svc.service}}OptionsDropDownButton" 
                            class="btn btn-xs btn-default pull-right" type="button">
                              <i class="fa fa-gear fa-fw"></i><i class="fa fa-fw fa-caret-down"></i>
                            </a>-->
                        </div>
                      </li>
                    </ul>
                  </div>
                  
                  <!-- Service Options -->
                  <div class="col-md-1">
                    <ul class="fa-ul">
                    <li ng-repeat="svc in stack.services track by svc.service">
                      <div class="row">
                        <!-- TODO: Can we even start/stop individual services?? -->
                         <!-- <button type="button" class="btn btn-xs btn-success" uib-tooltip="Start / Stop Service"><i class="fa fa-fw fa-play"></i></button>-->
                      
                          <!-- Link to endpoint(s) here -->
                          <!--<button type="button" ng-disabled="!stack.status || !svc.status" ng-repeat="endpoint in svc.endpoints" class="btn btn-xs btn-primary"
                              uib-tooltip="Navigate to Endpoint: {{ endpoint }}">
                            <i class="fa fa-fw fa-chain" ng-class="{ 'fa-chain': svc.status, 'fa-chain-broken':!svc.status }"></i>
                          </button>-->
                      </li>
                    </ul>
                  </div>
                  
                  <div class="row" ng-if="DEBUG">
                    <div class="col-md-12">
                      <pre>{{ stack | json }}</pre>
                    </div>
                  </div>
                </div>
            </uib-accordion-group>
          </uib-accordion>
        </div>
      </div>
    </div>
  </div>
  
  <div class="row" ng-if="DEBUG">
    <div class="col-md-12">
      <pre>{{ configuredVolumes | json }}</pre>
    </div>
  </div>
  
  <div class="row" ng-if="DEBUG">
    <div class="col-md-12">
      <pre>{{ allServices | json }}</pre>
    </div>
  </div>
  
    <!-- Confirm Delete (Modal) -->
  <div id="confirmModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div ng-include ng-src="'/app/expert/subviews/stackDeleteModal.html'"></div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</section>
