<section>
  <!-- Selector(s) Pane -->
  <div class="row" style="padding-left:">
    <div class="col-md-12">
      <div class="jumbotron text-center">
        <h1>Welcome to StackMaster</h1>
        <h4>Become <strong>one</strong> with the stack</h4>
      </div>
    </div>
  </div>
  <div class="row" ng-if="DEBUG">
    <div class="col-md-12">
      <pre>{{ allServices | json }}</pre>
    </div>
  </div>
  <div class="row">
    <div class="col-md-3">    
      <h4>Services</h4>
      <div>
        <div id="stackSearchHeader">
          <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><i class="fa fa-search"></i></span>
            <input type="text" class="form-control" placeholder="Search..." ng-model="svcQuery" 
                aria-describedby="basic-addon1" />
          </div>
          
          <span class="label label-danger" ng-show="(allServices | filter : svcQuery).length === 0">
            No services matched the specified query
          </span>
        </div>
        
        <table class="table table-striped table-condensed table-hover" 
            ng-hide="(allServices | filter : svcQuery).length === 0">
          <thead>
            <tr>
              <td width="95%"></td>
              <td width="5%"></td>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="stack in allServices | orderBy:'key'| filter : svcQuery">
              <td>{{ stack.label }}</td>
              <td>
                <button class="btn btn-xs btn-primary" ng-click="openWizard(stack)">
                  <i class="fa fa-plus"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
   
    <!-- Configured Stacks --> 
    <div class="col-md-9">
      <div>
        <h4>Configured Stacks</h4>
        <div ng-if="configuredStacks.length === 0" class="text-center" 
            style="border:dashed;padding-top:100px;padding-bottom:100px;vertical-align:middle;">
          <h2>It looks like you haven't configured any stacks yet!</h2>
          <h4>You can add services from the left-side of this page!</h4>
        </div>
        <uib-accordion ng-if="configuredStacks.length > 0" close-others="true">
          <uib-accordion-group ng-repeat="stack in configuredStacks" is-open="open">
            <uib-accordion-heading>
              <!-- Stack Enable / Disable -->
              <div class="row">
                <div class="col-md-1">
                  <i class="pull-left fa fa-fw fa-2x" 
                    ng-class="{ 'fa-check-circle-o': stack.status, 'fa-times-circle-o': !stack.status }"
                    ng-style="{ 'color': stack.status ? 'green' : 'red' }"></i>
                </div>
                <div class="col-md-10">
                  <h4>{{ _.capitalize(stack.name) }}</h4>
                </div>
                <div class="col-md-1">
                  <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': open, 'glyphicon-chevron-right': !open}"></i>
                </div>
              </div>
            </uib-accordion-heading>
            
              <!-- The stack's "Button Bar" -->
              <div class="row">
                <!-- Stack Enable / Disable -->
                <div class="col-md-2">
                  <div style="horizontal-align:middle;vertical-align:middle;">
                     <toggle-switch ng-model="stack.status" ng-changed="toggleStatus(stack)"><toggle-switch>
                  </div>
                </div>
                    
                <!-- The "Add Service" Button -->
                <div class="col-md-2">
                  <a class="btn btn-xs btn-success" tabindex="0" uib-popover-template="'/app/expert/subviews/serviceAddPopover.html'" 
                     popover-title="OPTIONAL SERVICES" ng-if="!stack.status && (stack.services | missingDeps:allServices:stack.name:'optional').length > 0"
                     popover-placement="bottom-left" popover-trigger="outsideClick">
                    <i class="fa fa-plus fa-fw"></i><i class="fa fa-fw fa-caret-down"></i>
                  </a>
                </div>
                
                <!-- The Delete Stack Button -->
                <div class="col-md-offset-6 col-md-2" style="horizontal-align:middle;vertical-align:middle;">
                  <button style="display:inline-block;margin:auto;" class="btn btn-lg btn-danger pull-right" ng-click="deletionCandidate = stack;removeCandidateStack(stack)" uib-tooltip="Delete this Stack from your Namespace">
                    <i class="fa fa-times"></i>
                  </button>
                </div>
              </div>
              
              <!-- Stack Services -->
              <div class="row">
                <div class="col-md-offset-2 col-md-4">
                  <ul class="fa-ul">
                    <!-- List off our stack's services here -->
                    <li ng-repeat="svc in stack.services">
                      <div class="row" style="margin:5px;">
                          <!-- show status icon if no volume(s) present -->
                          <i ng-if="!showVolume(stack, svc)" class="fa-li fa fa-fw" 
                            ng-style="{ 'color':stack.status ? 'green' : 'red' }"
                            ng-class="{ 'fa-check-circle-o':stack.status, 'fa-times-circle-o':!stack.status }"></i>
                            
                          <!-- show volume details if we find a volume -->
                          <i ng-if="showVolume(stack, svc)" class="fa-li fa fa-fw fa-database" style="cursor:pointer;"
                             ng-style="{ 'color':stack.status ? 'green' : 'red' }" 
                             uib-popover-template="'/app/expert/subviews/volumeDetailsPopover.html'" 
                             popover-title="{{ showVolume(stack, svc).name | uppercase }}"
                             popover-placement="right" popover-trigger="outsideClick"></i>
                             
                          {{ svc.serviceId }}
                          
                          <a ng-repeat="endpt in svc.endpoints" ng-if="stack.status && svc.status" href="{{ endpt }}"
                              uib-tooltip="Navigate to {{ _.capitalize(svc.serviceId) }} ({{ endpt }})">
                            <i class="fa fa-fw fa-chain"></i>
                          </a>
                             
                          <!-- link to endpoint, if one exists -->
                          <!--<div>
                            <a ng-if="svc.endpoints.length > 0" href="svc.endpoints[0]" style="margin-left:20px;">{{ svc.serviceId }}</a>
                            <span ng-if="svc.endpoints. length === 0">{{ svc.serviceId }}</span>
                          </div>-->
                          
                          <!-- "options" popover for services -->
                          <!--<a tabindex="0" uib-popover-template="'/app/expert/subviews/serviceOptionsPopover.html'" 
                          popover-title="{{ svc.serviceId | uppercase }}" popover-placement="left"
                          popover-trigger="focus" id="{{svc.serviceId}}OptionsDropDownButton" 
                          class="btn btn-xs btn-default pull-right" type="button">
                            <i class="fa fa-gear fa-fw"></i><i class="fa fa-fw fa-caret-down"></i>
                          </a>-->
                      </div>
                    </li>
                  </ul>
                </div>
                
                <!-- Service Options -->
                <div class="col-md-6">
                  <ul class="fa-ul">
                  <li ng-repeat="svc in stack.services">
                    <div class="row" style="margin:5px;">
                      <!-- TODO: Can we even start/stop individual services?? -->
                       <!-- <button type="button" class="btn btn-xs btn-success" uib-tooltip="Start / Stop Service"><i class="fa fa-fw fa-play"></i></button>-->
                    
                        <!-- Link to endpoint(s) here -->
                        <!--<button type="button" ng-disabled="!stack.status || !svc.status" ng-repeat="endpoint in svc.endpoints" class="btn btn-xs btn-primary"
                            uib-tooltip="Navigate to Endpoint: {{ endpoint }}">
                          <i class="fa fa-fw fa-chain" ng-class="{ 'fa-chain': svc.status, 'fa-chain-broken':!svc.status }"></i>
                        </button>-->
                    
                        <button type="button" class="btn btn-xs btn-info" uib-tooltip="View Logs"><i class="fa fa-fw fa-search"></i></button>
                    
                        <button type="button" ng-disabled="stack.services | isRecursivelyRequired:svc:stacks:deps" 
                        ng-if="svc.serviceId !== stack.key && (stack.services | missingDeps:allServices:stack.key:'required').indexOf(svc.serviceId) === -1" 
                            class="btn btn-xs btn-danger" ng-click="removeStackSvc(stack, svc)" 
                            uib-tooltip="Remove Service from Stack" tooltip-placement="left">
                          <i class="fa fa-fw fa-times"></i>
                        </button>
                      </div>
                    </li>
                  </ul>
                </div>
                
                <div class="row" ng-if="DEBUG">
                  <div class="col-md-12">
                    <pre>{{ stack | json }}</pre>
                  </div>
                </div>
              </div>
          </uib-accordion-group>
        </uib-accordion>
      </div>
    </div>
  </div>
  
    <!-- Confirm Delete (Modal) -->
  <div id="confirmModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div ng-include ng-src="'/app/expert/subviews/stackDeleteModal.html'" ng-controller="ExpertSetupController"></div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</section>
